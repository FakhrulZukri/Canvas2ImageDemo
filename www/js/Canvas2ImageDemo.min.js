/*! Canvas2ImageDemo - v0.1.0 - 2013-11-11
* Copyright (c) 2013 ; Licensed MIT */
!function(a,b){"use strict";var c=a.console||{};c.log=c.log||function(){};var d=a.Zepto;a.app={initialize:function(){document.addEventListener("deviceready",a.app.onDeviceReady,!1)},onDeviceReady:function(){function c(a){for(var c=a.offsetLeft,d=a.offsetTop,e=a.offsetParent;(a=a.parentNode)&&a.scrollLeft!==b;)c-=a.scrollLeft,d-=a.scrollTop,a===e&&(c+=a.offsetLeft,d+=a.offsetTop,e=a.offsetParent);return{x:c,y:d}}function e(a){var b={x:a.touches[0].pageX-g.x,y:a.touches[0].pageY-g.y};o[a.type](b)}d.os.ios&&parseFloat(a.device.version)>=7&&d(".app").css({top:"20px"});var f=document.getElementById("canvas");f.width=d(".main").width(),f.height=d(".main").height();var g=c(f),h=f.getContext("2d"),i=!0,j=a.devicePixelRatio||1,k=h.webkitBackingStorePixelRatio||h.mozBackingStorePixelRatio||h.msBackingStorePixelRatio||h.oBackingStorePixelRatio||h.backingStorePixelRatio||1,l=j/k;if("undefined"==typeof i&&(i=!0),i&&j!==k){var m=f.width,n=f.height;f.width=m*l,f.height=n*l,f.style.width=m+"px",f.style.height=n+"px",h.scale(l,l)}var o={isDrawing:!1,hasDrawing:!1,touchstart:function(a){h.lineWidth=4,h.beginPath(),h.moveTo(a.x,a.y),this.isDrawing=!0,d(".save, .clear").removeClass("disabled")},touchmove:function(a){this.isDrawing&&(h.lineTo(a.x,a.y),h.stroke())},touchend:function(){this.isDrawing&&(this.isDrawing=!1)}};f.addEventListener("touchstart",e,!1),f.addEventListener("touchmove",e,!1),f.addEventListener("touchend",e,!1),h.fillStyle="rgb(255,255,255)",h.fillRect(0,0,f.width,f.height),d(".clear").on("tap",function(){if(!d(this).hasClass("disabled")){var a=document.getElementById("canvas"),b=a.getContext("2d");b.fillStyle="rgb(255,255,255)",b.fillRect(0,0,a.width,a.height),o.hasDrawing=!1,d(".save, .clear").addClass("disabled")}}),d(".save").on("tap",function(){d(this).hasClass("disabled")||navigator.notification.confirm("Save the sketch?",function(b){2!==b&&(a.canvas2ImagePlugin.saveImageDataToLibrary(function(a){navigator.notification.alert(a,function(){},"Complete","OK")},function(a){navigator.notification.alert(a,function(){},"Error","OK")},document.getElementById("canvas")),d(".save").addClass("disabled"))},"Save",["OK","Cancel"])})}}}(window);